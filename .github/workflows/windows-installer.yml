# SPDX-FileCopyrightText: Â© 2021 Alias Developers
# SPDX-License-Identifier: MIT

name: Build Windows Installer

on:
  push:
    branches:
      - master
      - githubActionsRefactoring
  pull_request:
    branches:
      - master

jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
        with:
          persist-credentials: false

      # Download content to install
      - name: Download content to install
        uses: carlosperate/download-file-action@v1.0.3
        with:
          file-url: https://github.com/aliascash/alias-wallet/releases/download/4.3.1/Alias-4.3.1-425be867-Win64-Qt5.12.zip
          file-name: Alias.zip
          location: ${{ github.workspace }}
      - name: Extract content to install
        run: 7z x -o"${{ github.workspace }}/windows/content" "${{ github.workspace }}/Alias.zip"

      # Create installer
      - name: Create Windows installer
        uses: joncloud/makensis-action@v3.4
        with:
          arguments: "/V3"
          additional-plugin-paths: "${{ github.workspace }}/windows/plugins"
          script-file: "windows/Alias.nsi"
